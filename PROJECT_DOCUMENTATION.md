# Debate Card Battle - 辩论卡牌对战

## 项目概述

**Debate Card Battle（辩论卡牌对战）** 是一款创新的AI驱动辩论游戏，将传统的口头辩论与卡牌对战游戏（TCG）机制巧妙融合。玩家通过出牌的方式提出观点，AI生成反驳论点形成卡牌，双方以回合制方式展开智力对决，裁判AI为论点打分并转化为攻击力，最终通过血量系统决出胜负。

### 核心创新点

1. **卡牌化辩论机制**：将抽象的辩论过程具象化为可视化的卡牌对战
2. **AI三重角色**：对手AI、裁判AI、助手AI协同工作，模拟完整的辩论生态
3. **策略选择系统**：玩家主动选择AI的反驳卡牌，增加游戏的互动性和策略深度
4. **友善的竞技体验**：通过幽默的错误提示和人性化设计降低对抗的攻击性

---

## 演示视频

观看完整游戏演示，了解卡牌对战式辩论的魅力：

**视频链接**：[在此处添加你的视频链接]

视频内容包括：
- 完整对战流程演示（从出牌到胜负）
- AI三重角色协同工作展示
- 玩家主动选择AI卡牌的策略性
- 场外援助功能使用示范
- 友善错误提示的实际体验
- 历史记录和API配置功能展示

---

## 游戏玩法详解

### 游戏流程

#### 第一阶段：开局出牌
- 玩家拥有 **30点血量**，AI对手同样拥有 **30点血量**
- 玩家手牌包含5张预设观点卡牌（从60+话题库中随机抽取）
- 玩家可以：
  - 选择手牌中的任意一张卡牌出牌
  - 点击"自定义论点"创建个性化观点（最多200字）

#### 第二阶段：AI反驳与选择
- AI对手（Opponent AI）分析玩家论点，生成 **3张反驳卡牌**
- 每张卡牌包含：
  - 反驳论点内容
  - 攻击力（1-5点，由裁判AI评分）
  - 评分理由
- **玩家主动选择**：从3张AI卡牌中选择一张对自己造成伤害
  - 这一设计让玩家参与到AI的攻击过程中，增加策略性
  - 玩家可以根据评分理由判断哪个论点最"有道理"

#### 第三阶段：玩家反击
- 玩家受到选定卡牌的伤害后，进入反击阶段
- 玩家可以：
  1. **自行输入反击论点**：手动创建反驳内容
  2. **寻求场外援助**：AI助手基于上下文生成3个建议论点供选择
  3. **认输**：直接结束游戏
- 玩家提交反击后，裁判AI评分（1-5点）并转化为攻击力
  - **人性化加成**：如果玩家得分≤2分，系统自动+1攻击力（降低游戏难度）
- AI对手受到伤害

#### 第四阶段：循环对战
- AI对手基于玩家的反击论点，生成新一轮的3张反驳卡牌
- 重复"选择AI卡牌 → 玩家反击 → AI生成新卡牌"的循环
- 当任意一方血量归零时，游戏结束

---

## 核心功能特性

### 1. AI三重角色系统

#### Opponent AI（对手AI）
- **职责**：生成反驳论点
- **技术实现**：
  - 使用GPT-4o模型
  - 每次生成3个不同角度的反驳论点
  - 返回JSON格式的字符串数组
  - 自动解析Markdown代码块包裹的JSON

#### Referee AI（裁判AI）
- **职责**：评估论点强度
- **评分标准**：
  - 1分：非常弱（缺乏逻辑或证据）
  - 2分：弱（观点单薄）
  - 3分：中等（有效但不突出）
  - 4分：强（逻辑清晰、证据充分）
  - 5分：非常强（无懈可击的论证）
- **输出格式**：
  ```json
  {
    "attack": 3,
    "reason": "这是一个有效的观点，但缺乏强有力的证据。"
  }
  ```
- **上下文感知**：评分时考虑完整的辩论历史

#### Helper AI（助手AI）
- **职责**：为玩家提供反击建议
- **工作流程**：
  1. 基于玩家论点生成反方论点
  2. 再针对这些反方论点生成支持玩家的论点
  3. 返回3个建议供玩家选择

### 2. 卡牌系统

#### 预设话题库
- 包含 **62个精心设计的辩论话题**，涵盖：
  - 社会热点：四天工作制、延迟退休、网络暴力
  - 哲学思辨：人性本善、自由与规则、时间价值
  - 科技伦理：AI权利、隐私vs便利、数字货币
  - 个人成长：努力vs天赋、自律、时间管理
  - 生活方式：早起、独处、旅行、消费观

#### 自定义卡牌
- 玩家可创建完全自定义的论点
- 最大长度：200字符
- 实时字数统计
- 虚线边框的"+"卡牌提示创建入口

#### 卡牌展示
- **玩家手牌**：5张并排展示，可点击出牌
- **AI卡牌**：3张横向展示，显示完整内容和攻击力
- **激活卡牌**：玩家选择后，被选中的AI卡牌在AI区域单独显示

### 3. 战斗日志系统

实时记录每一步辩论过程，包括：
- **玩家出牌**：显示用户图标和论点内容
- **AI反击**：显示AI图标、论点内容、攻击力和评分理由
- **玩家反击**：显示攻击力和裁判评分理由
- **伤害记录**：红色心形图标标注伤害值和受伤对象

日志特性：
- 自动滚动到最新记录
- 卡片式布局，清晰区分每条记录
- 图标化展示（用户/AI/闪电/心形）

### 4. 历史记录功能

#### 存储内容
- 对战时间
- 胜负结果（Player/AI）
- 完整游戏日志
- 双方最终血量
- 首个论点作为标题

#### 功能操作
- **查看历史**：重新加载对战记录，在游戏界面展示完整日志
- **删除单条**：二次确认弹窗防止误删
- **清空全部**：批量删除所有历史记录
- **本地持久化**：使用localStorage存储，浏览器关闭后数据不丢失

### 5. API Key管理

#### 配置方式
- 通过设置弹窗输入API Key
- 密码输入框保护隐私
- 本地存储（localStorage key: `ai_api_key`）
- 配置后立即生效，无需重启

#### 功能特性
- **保存配置**：存储API Key并显示长度确认
- **清除配置**：等同于"退出登录"，二次确认防止误操作
- **检查工具**：调试按钮可查看localStorage中的实际值
- **配置验证**：保存后自动验证是否成功存储

#### API调用
- 端点：`/api/chat/completions`
- 模型：`gpt-4o`
- 请求头包含多种认证方式：
  - `Authorization: Bearer {apiKey}`
  - `X-API-Key: {apiKey}`
  - `api-key: {apiKey}`
- 温度参数：0.7（平衡创造性和一致性）
- 最大token：1500

### 6. 错误处理与用户体验

#### 友善的错误提示

当AI调用失败时，不直接显示技术错误，而是用幽默的拟人化提示：

1. **对手AI错误**（生成反驳失败）
   - 标题："对手走神了"
   - 内容："对手AI未能返回有效反驳论点，无法继续辩论。\n是否提醒对手，让他继续辩论？"
   - 操作：
     - "敲敲桌子，让对手继续辩论"（重试）
     - "拍桌而起，径直离去"（退出）

2. **裁判AI错误**（评分失败）
   - 标题："裁判打瞌睡了"
   - 内容："裁判AI未能返回有效打分，无法继续辩论。\n是否叫醒裁判，让他继续工作？"
   - 操作：
     - "叫醒裁判，继续辩论"（重试）
     - "不叫醒，起身离席，停止辩论"（退出）

3. **下一轮生成错误**（玩家反击后AI无法生成新卡牌）
   - 标题："对手被你镇住了"
   - 内容："你的论点太强，对手一时语塞，没能想出下一轮的反驳。\n是否给他一点时间，让他好好想想？"
   - 操作：
     - "给他点时间"（重试）
     - "乘胜追击，结束辩论"（退出）

#### 重试机制
- 错误发生时自动保存最后一次操作（lastAction）
- 重试时重新执行该操作
- 防止游戏日志重复：重试前移除最后一条临时记录
- 区分不同错误类型，采用不同的重试策略

#### 加载状态
- **AI思考中**：Spin组件显示"AI 正在思考..."
- **玩家操作中**：按钮显示加载状态，禁用所有交互
- 防止重复提交和并发请求

### 7. 界面设计

#### 布局结构
```
┌─────────────────────────────────────┐
│  Header: 标题 + 设置按钮 + 历史按钮  │
├─────────────────────────────────────┤
│  ┌──────────┬──────────────────┐   │
│  │ AI头像   │  AI卡牌区域      │   │
│  │ 血量显示 │  (3张或背面)     │   │
│  └──────────┴──────────────────┘   │
│  ┌────────────────────────────┐    │
│  │      游戏日志（滚动区）     │    │
│  └────────────────────────────┘    │
│  ┌──────────┬──────────────────┐   │
│  │ 玩家头像 │  玩家操作区域    │   │
│  │ 血量显示 │  (手牌/输入框)   │   │
│  └──────────┴──────────────────┘   │
├─────────────────────────────────────┤
│  Footer: 版权信息                   │
└─────────────────────────────────────┘
```

#### 视觉特性
- **暗色主题**：AI区域使用深色背景（#141414）营造对战氛围
- **头像系统**：
  - 玩家/AI分别有独立头像组件
  - 血量显示为分数形式（当前/最大）
  - 头像区域固定宽度120px
- **卡牌动画**：悬停时卡片轻微上浮（hoverable）
- **响应式设计**：最大宽度900px，居中显示

#### 游戏状态
- **START**：显示玩家手牌
- **PLAYER_CHOOSING_AI_CARD**：显示3张AI卡牌供选择
- **PLAYER_CREATING_COUNTER**：显示文本输入框和辅助按钮
- **PLAYER_CHOOSING_HELPFUL_CARD**：显示助手AI生成的3个建议
- **GAME_OVER**：显示胜负结果和"再来一局"按钮

---

## 技术架构

### 技术栈
- **前端框架**：React 19.1.1 + Vite 7.1.7
- **UI组件库**：Ant Design 5.27.5
- **状态管理**：React Hooks（useState, useEffect）
- **数据持久化**：localStorage
- **唯一标识**：uuid 13.0.0
- **AI模型**：GPT-4o（通过自定义API端点）

### 核心服务

#### AIService（src/services/aiService.js）

**职责**：封装所有AI相关的API调用

**核心方法**：

1. **callAI(messages)**
   - 通用的AI调用接口
   - 处理认证、请求、响应解析
   - 错误处理和日志记录

2. **generateCounterArguments(opinion)**
   - 生成3个反驳论点
   - 返回JSON数组
   - 自动解析Markdown代码块

3. **rateArgument(conversationHistory, argumentToRate)**
   - 基于上下文评估论点
   - 返回攻击力（1-5）和评分理由
   - 中英文混合prompt确保准确性

4. **getHelpfulArguments(opinion)**
   - 组合调用：先生成反方论点，再生成支持论点
   - 返回3个建议论点

**错误处理**：
- 自定义 `AIConnectionError` 类
- 区分连接错误、格式错误、API错误
- 详细的控制台日志便于调试

### 状态管理

#### 核心状态（App.jsx）

```javascript
// 游戏状态
gameState: 'START' | 'PLAYER_CHOOSING_AI_CARD' | 'PLAYER_CREATING_COUNTER' | 'GAME_OVER'

// 血量系统
playerHealth: number  // 默认30
aiHealth: number      // 默认30

// 卡牌系统
playerHand: string[]           // 玩家手牌（5张）
aiCards: Card[]                // AI卡牌（3张）
activeAiCard: Card | null      // 激活的AI卡牌

// 日志系统
gameLog: LogEntry[]            // 完整对战记录

// UI状态
aiThinking: boolean            // AI生成中
playerThinking: boolean        // 玩家操作中

// 错误处理
aiErrorState: null | 'OPPONENT_AI_ERROR' | 'REFEREE_AI_ERROR' | 'OPPONENT_AI_NEXT_ROUND_ERROR'
lastAction: { type, payload }  // 用于重试

// 辅助功能
helpfulArguments: Card[]       // 助手AI建议
history: HistoryItem[]         // 历史记录
```

#### 数据流

1. **玩家出牌**：
   ```
   PlayerHand.onPlayCard
   → App.handlePlayCard
   → AIService.generateCounterArguments
   → AIService.rateArgument (×3)
   → setState(aiCards)
   → gameState = 'PLAYER_CHOOSING_AI_CARD'
   ```

2. **选择AI卡牌**：
   ```
   AICards.onChooseCard
   → App.handleChooseAiCard
   → 扣除玩家血量
   → 记录日志
   → gameState = 'PLAYER_CREATING_COUNTER'
   ```

3. **玩家反击**：
   ```
   GameScreen.handleSubmitCounter
   → App.handlePlayerCounter
   → AIService.rateArgument
   → 扣除AI血量
   → AIService.generateCounterArguments (新一轮)
   → gameState = 'PLAYER_CHOOSING_AI_CARD'
   ```

### 组件结构

```
App.jsx (主容器)
├── Header
│   ├── 标题
│   ├── 设置按钮 → SettingsModal
│   └── 历史按钮 → HistoryDrawer
├── GameScreen (游戏主界面)
│   ├── AI区域
│   │   ├── AIAvatar (头像)
│   │   └── AICards / ActiveCard (卡牌)
│   ├── GameLog (对战日志)
│   └── 玩家区域
│       ├── PlayerAvatar (头像)
│       └── PlayerHand / TextArea / HelpfulCards (操作区)
├── SettingsModal (API配置)
├── HistoryDrawer (历史记录)
└── Footer
```

---

## 游戏平衡性设计

### 1. 人性化加成
- 玩家论点评分≤2分时，自动+1攻击力
- 防止玩家因论点质量差导致游戏体验过于挫败

### 2. 双方血量对等
- 玩家和AI均为30点血量
- 攻击力范围1-5点，平均对战6-30回合

### 3. 策略性选择
- 玩家主动选择AI卡牌，可根据评分理由规避高伤害
- 场外援助提供备选方案，降低思考难度

### 4. 认输机制
- 玩家可随时认输，避免被迫完成无法继续的游戏

---

## 亮点总结

### 1. 创新的游戏机制
- **辩论卡牌化**：将抽象思维对抗转化为具象游戏体验
- **主动选择伤害**：颠覆传统被动受击模式，增强互动性
- **AI三重角色**：对手、裁判、助手协同工作，模拟真实辩论环境

### 2. 友善的用户体验
- **幽默错误提示**：技术错误拟人化，降低挫败感
- **重试机制**：网络问题不中断游戏进度
- **人性化加成**：保护新手玩家，提升游戏可玩性

### 3. 丰富的内容生态
- **62个精选话题**：覆盖社会、哲学、科技、生活等多个领域
- **自定义论点**：支持完全自由的观点创作
- **上下文感知**：AI评分基于完整辩论历史，确保逻辑连贯

### 4. 完善的功能闭环
- **历史记录**：永久保存对战过程
- **API配置**：灵活适配不同AI服务
- **响应式UI**：清晰的视觉层次和状态反馈

---

## 技术特色

### 1. 健壮的错误处理
- 自定义错误类型（`AIConnectionError`）
- 区分不同AI角色的错误状态
- 保存lastAction支持精确重试

### 2. 智能的JSON解析
- 自动识别并去除Markdown代码块包裹
- 容错性强的响应处理

### 3. 清晰的状态机
- 5种明确的游戏状态
- 单向数据流，易于调试

### 4. 性能优化
- 自动滚动到最新日志
- localStorage增量更新
- 避免不必要的重渲染

---

## 使用指南

### 1. 环境准备
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 2. 配置API
1. 点击右上角"设置"按钮
2. 输入你的API Key（支持OpenAI兼容接口）
3. 保存配置

### 3. 开始游戏
1. 从5张手牌中选择一张出牌，或创建自定义论点
2. 等待AI生成3张反驳卡牌
3. 选择一张AI卡牌对自己造成伤害
4. 输入反击论点，或使用"场外援助"获取建议
5. 重复步骤2-4，直到一方血量归零

### 4. 查看历史
1. 点击右上角"查看历史"按钮
2. 在列表中选择历史记录查看完整对战日志
3. 可删除单条记录或清空全部

---

## 未来扩展方向

### 游戏性增强
- **难度等级**：调整AI生成论点的质量和数量
- **主题模式**：科技、哲学、生活等专题对战
- **排行榜**：记录连胜纪录和最高得分

### 社交功能
- **分享对战**：导出对战记录为图片或文本
- **多人对战**：玩家vs玩家模式

### AI优化
- **记忆系统**：AI记住玩家的辩论风格
- **性格设定**：选择不同性格的AI对手（激进/温和/幽默）

### 内容扩展
- **话题投票**：社区贡献和投票新话题
- **季节话题**：根据时事热点更新话题库

---

## 项目文件说明

```
debater/
├── src/
│   ├── App.jsx                      # 主应用逻辑
│   ├── main.jsx                     # 入口文件
│   ├── topics.js                    # 话题库和洗牌函数
│   ├── components/
│   │   ├── GameScreen.jsx           # 游戏主界面
│   │   ├── PlayerHand.jsx           # 玩家手牌组件
│   │   ├── AICards.jsx              # AI卡牌组件
│   │   ├── ActiveCard.jsx           # 激活卡牌展示
│   │   ├── HelpfulCards.jsx         # 助手建议卡牌
│   │   ├── GameLog.jsx              # 对战日志
│   │   ├── PlayerAvatar.jsx         # 玩家头像
│   │   ├── AIAvatar.jsx             # AI头像
│   │   ├── HandContainer.jsx        # 手牌容器
│   │   ├── HistoryDrawer.jsx        # 历史记录侧边栏
│   │   ├── SettingsModal.jsx        # 设置弹窗
│   │   ├── DebateModal.jsx          # 辩论弹窗（未使用）
│   │   ├── FocusedCardModal.jsx     # 聚焦卡牌（未使用）
│   │   ├── PresetTopics.jsx         # 预设话题（未使用）
│   │   └── CustomArgumentModal.jsx  # 自定义论点（已集成到PlayerHand）
│   └── services/
│       └── aiService.js             # AI服务封装
├── public/                          # 静态资源
├── index.html                       # HTML模板
├── package.json                     # 项目配置
├── vite.config.js                   # Vite配置
└── eslint.config.js                 # ESLint配置
```

---

## 开发者备注

### API端点说明
- 默认使用 `/api/chat/completions` 作为代理端点
- 需要配置反向代理或直接修改 `baseUrl` 指向OpenAI兼容接口
- 认证方式支持多种Header格式以兼容不同服务

### localStorage键名
- `ai_api_key`：存储API Key
- `debateHistory`：存储历史记录（JSON数组）

### 调试技巧
- 打开浏览器控制台查看详细的API请求日志
- 设置弹窗中的"检查localStorage"按钮可验证配置
- 游戏日志组件会显示所有对战步骤，便于排查逻辑问题

---

## 许可证

Debate Card Battle ©2024

---

## 致谢

感谢所有为这个项目提供灵感的辩论爱好者和卡牌游戏玩家！
