# 开发文档：友好抬杠助手 - 卡牌对战版

## 1. 项目愿景

本项目旨在将原有的“友好抬杠助手”应用，从一个简单的观点生成工具，重构成一个富有策略性和趣味性的回合制卡牌对战游戏。玩家与AI将通过提出和反驳论点来进行“攻击”和“防御”，最终目标是先将对方的生命值削减至0。

## 2. 核心玩法循环

游戏以回合制进行，完整的一轮包含以下步骤：

1.  **玩家出牌**:
    *   游戏开始时，玩家从5张随机抽取的“辩题手牌”中选择一张打出，或选择“自定义论点”来创建一张新卡牌。
    *   这张卡牌成为本轮的基础论点。

2.  **AI反击**:
    *   “对手AI” (`generateCounterArguments`) 针对玩家的论点，生成三张“反击卡牌”。

3.  **裁判秘密评定 (AI)**:
    *   “裁判AI” (`rateArgument`) 接收完整的辩论历史和每一张AI的反击卡牌，为这三张卡牌秘密评定攻击力（1-3），此阶段不向玩家展示。

4.  **玩家选择与承受伤害**:
    *   三张AI反击卡牌的内容展示给玩家。
    *   玩家必须选择其中一张进行反击。
    *   选择后，该AI卡牌的攻击力被揭示，玩家的生命值 (`playerHealth`) 减少相应的点数。

5.  **玩家制作反击卡牌**:
    *   玩家针对所选的AI卡牌，撰写自己的反击论点，制作成一张新的“玩家卡牌”。

6.  **裁判评定 (玩家)**:
    *   “裁判AI” (`rateArgument`) 接收完整的辩论历史和玩家新制作的卡牌，为其评定攻击力（1-3）。

7.  **对AI造成伤害**:
    *   玩家卡牌的攻击力被揭示，AI的生命值 (`aiHealth`) 减少相应的点数。

8.  **回合结束**:
    *   进入下一轮，对手AI将针对玩家最新的反击论点，再次生成三张新的反击卡牌，循环往复。

9.  **胜利/失败条件**:
    *   初始生命值为30点。
    *   任何一方的生命值先达到或超过30点伤害，判定为输掉本场辩论。

## 3. 游戏状态管理 (`App.jsx`)

`App.jsx` 将作为游戏的主引擎，管理所有核心状态：

*   `gameState` (string): 标记当前游戏阶段。例如:
    *   `'START'`: 游戏开始，等待玩家选择初始手牌。
    *   `'PLAYER_CHOOSING_CARD'`: 玩家已出牌，等待AI生成卡牌。
    *   `'AI_CARDS_GENERATED'`: AI已生成卡牌，等待玩家选择反击目标。
    *   `'PLAYER_CREATING_COUNTER'`: 玩家已选择AI卡牌并承受伤害，正在制作自己的反击卡牌。
    *   `'ROUND_END'`: 双方完成一轮攻防。
    *   `'GAME_OVER'`: 游戏结束。
*   `playerHealth` (number): 玩家当前生命值。
*   `aiHealth` (number): AI当前生命值。
*   `playerHand` (Array<string>): 存储5个随机辩题的数组，作为玩家的初始手牌。
*   `gameLog` (Array<Object>): 记录整个战斗流程的“战报”，用于展示和作为AI判断的上下文。每个对象代表一个事件，例如：
    ```json
    {
      "type": "PLAYER_CARD",
      "content": "读书能改变命运",
      "attack": 2,
      "reason": "这是一个有力的正面论点..."
    }
    ```
*   `aiCards` (Array<Object>): 存储当前回合AI生成的三张卡牌及其被秘密评定的攻击力。

## 4. AI服务接口 (`src/services/aiService.js`)

*   **`generateCounterArguments(opinion)`**:
    *   **角色**: 对手AI。
    *   **职责**: 保持不变，接收一个观点，返回包含三个反方论点的JSON对象。
*   **`rateArgument(conversationHistory, argumentToRate)`**:
    *   **角色**: 裁判AI。
    *   **职责**: 接收`gameLog`作为`conversationHistory`，以及需要被评定的论点`argumentToRate`。返回一个包含攻击力和评定理由的JSON对象: `{ "attack": number, "reason": "string" }`。
    *   **Prompt核心思想**: 指示AI根据上下文，从逻辑性、说服力、相关性等方面，综合评估`argumentToRate`的强度，并给出1-3的评分。

## 5. 组件架构

*   **`App.jsx`**: 游戏引擎，处理所有逻辑和状态切换。
*   **`GameScreen.jsx`**: 游戏主界面，根据`gameState`渲染不同视图（如生命条、战报区、操作区）。
*   **`PlayerHand.jsx`**: 在游戏开始时显示玩家的5张手牌，并提供“自定义论点”的选项。
*   **`AICards.jsx`**: 展示AI生成的三张反击卡牌，并处理玩家的选择。
*   **`GameLog.jsx`**: 渲染`gameLog`，以文字形式清晰地展示战报。

## 6. 分阶段开发计划

1.  **阶段一：项目清理与搭建**:
    *   创建此开发文档。
    *   备份并移除`App.jsx`中的旧逻辑。
    *   创建`GameScreen.jsx`, `PlayerHand.jsx`, `AICards.jsx`, `GameLog.jsx`等新组件的空文件。
    *   在`App.jsx`中搭建新的基础状态（生命值、游戏阶段等）。

2.  **阶段二：AI服务升级**:
    *   在`aiService.js`中实现新的`rateArgument`函数，并编写好相应的Prompt。

3.  **阶段三：游戏开局**:
    *   实现手牌机制：从`PresetTopics`中随机抽取5个话题作为手牌。
    *   实现`PlayerHand.jsx`组件，让玩家可以选择手牌或自定义论点来开始游戏。

4.  **阶段四：AI回合与玩家选择**:
    *   实现玩家出牌后，调用AI生成三张反击卡牌的逻辑。
    *   实现调用裁判AI为这三张卡牌秘密评定攻击力。
    *   实现`AICards.jsx`组件，展示AI卡牌并允许玩家选择。

5.  **阶段五：伤害计算与玩家反击**:
    *   实现玩家选择AI卡牌后，计算并更新玩家生命值。
    *   提供输入框，让玩家可以创建自己的反击卡牌。

6.  **阶段六：完成循环与结束条件**:
    *   实现玩家反击卡牌的攻击力评定和对AI的伤害计算。
    *   完成一轮完整的游戏循环。
    *   添加胜负判断逻辑，实现`GAME_OVER`阶段。
